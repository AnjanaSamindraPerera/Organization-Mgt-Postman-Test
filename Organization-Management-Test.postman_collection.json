{
	"info": {
		"_postman_id": "713b01bd-60e1-4ba0-b1d3-eaffb76aebf1",
		"name": "Organization-Management-Test",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "Create internal Roles",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "c23114ac-3003-4b93-9e47-f29abb52370e",
						"exec": [
							"pm.test(\"Successful POST request\", function () {",
							"    pm.expect(pm.response.code).to.be.oneOf([201, 202]);",
							"});",
							"",
							"let jsonData = pm.response.json();",
							"pm.environment.set(\"OrgAdminRoleId\", jsonData.id);",
							"",
							"pm.test(\"Response includes specified elements\", function () {",
							"    let response = pm.response.json();",
							"    pm.expect(response).to.have.ownProperty(\"id\"); ",
							"    pm.expect(response).to.have.ownProperty(\"displayName\"); ",
							"    pm.expect(response.displayName).to.equal(\"Internal/Organization_Administrator\");",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"auth": {
					"type": "basic",
					"basic": [
						{
							"key": "password",
							"value": "{{admin_password}}",
							"type": "string"
						},
						{
							"key": "username",
							"value": "{{admin_username}}",
							"type": "string"
						}
					]
				},
				"method": "POST",
				"header": [],
				"body": {
					"mode": "raw",
					"raw": "{\n  \"schemas\": [\n    \"urn:ietf:params:scim:schemas:core:2.0:Group\"\n  ],\n  \"displayName\": \"INTERNAL/Organization_Administrator\"\n}",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "{{base_url}}/scim2/Groups",
					"host": [
						"{{base_url}}"
					],
					"path": [
						"scim2",
						"Groups"
					]
				}
			},
			"response": []
		},
		{
			"name": "Assign permissions to the org_admin role",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "846e389d-595d-4e2e-87e2-26146aecd160",
						"exec": [
							"pm.test(\"Status code is 200\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"pm.test(\"Response includes specified elements\", function () {",
							"    let response = pm.response.json();",
							"    pm.expect(response).to.have.instanceOf(Array);",
							"    ",
							"});",
							""
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"auth": {
					"type": "basic",
					"basic": [
						{
							"key": "password",
							"value": "{{admin_password}}",
							"type": "string"
						},
						{
							"key": "username",
							"value": "{{admin_username}}",
							"type": "string"
						}
					]
				},
				"method": "PUT",
				"header": [],
				"body": {
					"mode": "raw",
					"raw": "[ \n \"/permission/admin/manage/identity/organizationmgt\"\n]",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "{{base_url}}/scim2/Groups/{{OrgAdminRoleId}}/permissions",
					"host": [
						"{{base_url}}"
					],
					"path": [
						"scim2",
						"Groups",
						"{{OrgAdminRoleId}}",
						"permissions"
					]
				}
			},
			"response": []
		},
		{
			"name": "Create Organization in ROOT",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "39f1c351-2f68-433c-9512-bbf0e730a459",
						"exec": [
							"pm.test(\"Successful POST request\", function () {",
							"    pm.expect(pm.response.code).to.be.oneOf([201, 202]);",
							"});",
							"",
							"let jsonData = pm.response.json();",
							"pm.environment.set(\"ParentOrg\", jsonData.id);",
							"",
							"pm.test(\"Response includes specified elements\", function () {",
							"    let response = pm.response.json();",
							"    pm.expect(response).to.have.ownProperty(\"name\"); ",
							"    pm.expect(response.name).to.equal(\"wso2\");",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"auth": {
					"type": "basic",
					"basic": [
						{
							"key": "password",
							"value": "{{admin_password}}",
							"type": "string"
						},
						{
							"key": "username",
							"value": "{{admin_username}}",
							"type": "string"
						}
					]
				},
				"method": "POST",
				"header": [],
				"body": {
					"mode": "raw",
					"raw": "{\n            \"name\": \"wso2\",\n            \"displayName\": \"WSO2\",\n            \"description\": \"LK organization\",\n            \"attributes\": [\n                {\n                    \"key\": \"Type\",\n                    \"value\": \"partner\"\n                },\n                {\n                    \"key\": \"Exp\",\n                    \"value\": \"2021\"\n                }\n            ],\n            \"userStoreConfigs\": [\n                {\n                    \"key\": \"RDN\",\n                    \"value\": \"wso2\"\n                },\n                {\n                    \"key\": \"USER_STORE_DOMAIN\",\n                    \"value\": \"WSO2.COM\"\n                }\n            ]\n        }",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "{{base_url}}/api/identity/organization-mgt/v1.0/organizations/",
					"host": [
						"{{base_url}}"
					],
					"path": [
						"api",
						"identity",
						"organization-mgt",
						"v1.0",
						"organizations",
						""
					]
				}
			},
			"response": []
		},
		{
			"name": "GET Organization",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "ffb744e3-aaa9-40c0-a173-54a2c89efd34",
						"exec": [
							"pm.test(\"Status code is 200\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"pm.test(\"Response includes specified elements\", function () {",
							"    let response = pm.response.json();",
							"    pm.expect(response).to.have.ownProperty(\"parent\"); ",
							"    pm.expect(response.parent.id).to.equal(\"ROOT\");",
							"",
							"    pm.expect(response).to.have.ownProperty(\"meta\"); ",
							"    pm.expect(response).to.have.ownProperty(\"attributes\");",
							"});",
							""
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"auth": {
					"type": "basic",
					"basic": [
						{
							"key": "password",
							"value": "{{admin_password}}",
							"type": "string"
						},
						{
							"key": "username",
							"value": "{{admin_username}}",
							"type": "string"
						}
					]
				},
				"method": "GET",
				"header": [],
				"url": {
					"raw": "{{base_url}}/api/identity/organization-mgt/v1.0/organizations/{{ParentOrg}}",
					"host": [
						"{{base_url}}"
					],
					"path": [
						"api",
						"identity",
						"organization-mgt",
						"v1.0",
						"organizations",
						"{{ParentOrg}}"
					]
				}
			},
			"response": []
		},
		{
			"name": "PATCH the created organization",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "ee16fe78-ff09-4efb-a49a-b9012add424b",
						"exec": [
							"pm.test(\"Status code is 200\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							""
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"auth": {
					"type": "basic",
					"basic": [
						{
							"key": "password",
							"value": "{{admin_password}}",
							"type": "string"
						},
						{
							"key": "username",
							"value": "{{admin_username}}",
							"type": "string"
						}
					]
				},
				"method": "PATCH",
				"header": [],
				"body": {
					"mode": "raw",
					"raw": "[\n    {\n        \"op\": \"add\",\n        \"path\": \"/attributes/validate\",\n        \"value\": \"true\"\n    },\n    {\n        \"op\": \"remove\",\n        \"path\": \"/attributes/Exp\"\n    },\n    {\n        \"op\": \"replace\",\n        \"path\": \"/description\",\n        \"value\": \"Parent Organization\"\n    }\n]",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "{{base_url}}/api/identity/organization-mgt/v1.0/organizations/{{ParentOrg}}",
					"host": [
						"{{base_url}}"
					],
					"path": [
						"api",
						"identity",
						"organization-mgt",
						"v1.0",
						"organizations",
						"{{ParentOrg}}"
					]
				}
			},
			"response": []
		},
		{
			"name": "Create User in parent org",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "be3195ae-4dc0-4225-b55d-390188ba9e91",
						"exec": [
							"pm.test(\"Successful POST request\", function () {",
							"    pm.expect(pm.response.code).to.be.oneOf([201, 202]);",
							"});",
							"",
							"let jsonData = pm.response.json();",
							"pm.environment.set(\"UserInParentOrg\", jsonData.id);",
							"pm.environment.set(\"UserName-UserInParentOrg\", jsonData.userName);",
							"",
							"pm.test(\"Response includes specified elements\", function () {",
							"    let response = pm.response.json();",
							"    pm.expect(response).to.have.ownProperty(\"name\"); ",
							"    pm.expect(response.name.givenName).to.equal(\"Paul\");",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"auth": {
					"type": "basic",
					"basic": [
						{
							"key": "password",
							"value": "{{admin_password}}",
							"type": "string"
						},
						{
							"key": "username",
							"value": "{{admin_username}}",
							"type": "string"
						}
					]
				},
				"method": "POST",
				"header": [],
				"body": {
					"mode": "raw",
					"raw": "{\"schemas\":[],\n    \"name\":{\n        \"familyName\":\"Smith\",\n        \"givenName\":\"Paul\"\n    },\n    \"userName\":\"{{UserName-UserInParentOrg}}\",\n    \"password\":\"Smith123\",\n     \"urn:ietf:params:scim:schemas:extension:enterprise:2.0:User\": {\n        \"organization\": {\n            \"name\": \"wso2\"\n        }\n    }\n}",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "{{base_url}}/scim2/Users",
					"host": [
						"{{base_url}}"
					],
					"path": [
						"scim2",
						"Users"
					]
				}
			},
			"response": []
		},
		{
			"name": "Create sub org by new user without permission",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "220346d5-483d-4954-bec6-d7549f93dcb2",
						"exec": [
							"pm.test(\"POST request without proper permissions\", function () {",
							"      pm.response.to.have.status(400);",
							"});",
							"",
							"pm.test(\"Response includes error code for unauthorization\", function () {",
							"    let response = pm.response.json();",
							"    pm.expect(response).to.have.ownProperty(\"code\"); ",
							"    pm.expect(response.code).to.equal(\"ORGMGT_00014\");",
							"});",
							"",
							""
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"auth": {
					"type": "basic",
					"basic": [
						{
							"key": "username",
							"value": "{{UserName-UserInParentOrg}}",
							"type": "string"
						},
						{
							"key": "password",
							"value": "{{Password-UserInParentOrg}}",
							"type": "string"
						}
					]
				},
				"method": "POST",
				"header": [],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"name\": \"wso2-LK\",\n    \"displayName\": \"WSO2-LK\",\n    \"description\": \"LK organization\",\n    \"attributes\": [\n        {\n            \"key\": \"Type\",\n            \"value\": \"partner\"\n        },\n        {\n            \"key\": \"Exp\",\n            \"value\": \"2021\"\n        }\n    ],\n    \"userStoreConfigs\": [\n        {\n            \"key\": \"RDN\",\n            \"value\": \"wso2-LK\"\n        },\n        {\n            \"key\": \"USER_STORE_DOMAIN\",\n            \"value\": \"WSO2.COM\"\n        }\n    ]\n}",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "{{base_url}}/api/identity/organization-mgt/v1.0/organizations/",
					"host": [
						"{{base_url}}"
					],
					"path": [
						"api",
						"identity",
						"organization-mgt",
						"v1.0",
						"organizations",
						""
					]
				}
			},
			"response": []
		},
		{
			"name": "Assign org_admin role to new user over the parent org",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "55e0b14a-0b29-45c1-9b32-c975564f88c8",
						"exec": [
							"pm.test(\"Status code is 200\", function () {",
							"    pm.response.to.have.status(200);",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"auth": {
					"type": "basic",
					"basic": [
						{
							"key": "password",
							"value": "{{admin_password}}",
							"type": "string"
						},
						{
							"key": "username",
							"value": "{{admin_username}}",
							"type": "string"
						}
					]
				},
				"method": "POST",
				"header": [],
				"body": {
					"mode": "raw",
					"raw": "[\n {\n   \"roleId\": \"{{OrgAdminRoleId}}\",\n   \"users\": [\n     \"{{UserInParentOrg}}\"\n   ]\n }\n]\n",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "{{base_url}}/api/identity/organization-mgt/v1.0/organizations/{{ParentOrg}}/roles",
					"host": [
						"{{base_url}}"
					],
					"path": [
						"api",
						"identity",
						"organization-mgt",
						"v1.0",
						"organizations",
						"{{ParentOrg}}",
						"roles"
					]
				}
			},
			"response": []
		},
		{
			"name": "Create sub org by new user with permissions",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "0358812c-0df1-4e06-9e51-bb085ee741e1",
						"exec": [
							"pm.test(\"Successful POST request\", function () {",
							"    pm.expect(pm.response.code).to.be.oneOf([201, 202]);",
							"});",
							"",
							"let jsonData = pm.response.json();",
							"pm.environment.set(\"SubOrg\", jsonData.id);",
							"",
							"pm.test(\"Response includes specified elements\", function () {",
							"    let response = pm.response.json();",
							"    pm.expect(response).to.have.ownProperty(\"name\"); ",
							"    pm.expect(response.name).to.equal(\"wso2-LK\");",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"auth": {
					"type": "basic",
					"basic": [
						{
							"key": "password",
							"value": "{{Password-UserInParentOrg}}",
							"type": "string"
						},
						{
							"key": "username",
							"value": "{{UserName-UserInParentOrg}}",
							"type": "string"
						}
					]
				},
				"method": "POST",
				"header": [],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"name\": \"wso2-LK\",\n    \"displayName\": \"WSO2-LK\",\n    \"parentId\": \"{{ParentOrg}}\",\n    \"description\": \"LK organization\",\n    \"attributes\": [\n        {\n            \"key\": \"Type\",\n            \"value\": \"partner\"\n        },\n        {\n            \"key\": \"Exp\",\n            \"value\": \"2021\"\n        }\n    ],\n    \"userStoreConfigs\": [\n        {\n            \"key\": \"RDN\",\n            \"value\": \"wso2-LK\"\n        },\n        {\n            \"key\": \"USER_STORE_DOMAIN\",\n            \"value\": \"WSO2.COM\"\n        }\n    ]\n}",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "{{base_url}}/api/identity/organization-mgt/v1.0/organizations/",
					"host": [
						"{{base_url}}"
					],
					"path": [
						"api",
						"identity",
						"organization-mgt",
						"v1.0",
						"organizations",
						""
					]
				}
			},
			"response": []
		}
	],
	"protocolProfileBehavior": {}
}